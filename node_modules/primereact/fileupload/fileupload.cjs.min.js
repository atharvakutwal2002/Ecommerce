"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("primereact/api"),n=require("primereact/button"),l=require("primereact/messages"),r=require("primereact/progressbar"),a=require("primereact/ripple"),o=require("primereact/utils");function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var l=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var u=i(e);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},s.apply(this,arguments)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}function p(e){if(Array.isArray(e))return c(e)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function f(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e){return p(e)||m(e)||f(e)||d()}function b(e){throw new TypeError('"'+e+'" is read-only')}function v(e){if(Array.isArray(e))return e}function g(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,r,a,o,i=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(l=a.call(n)).done)&&(i.push(l.value),i.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw r}}return i}}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e,t){return v(e)||g(e,t)||f(e,t)||h()}var S={defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,widthCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0},getProps:function(e){return o.ObjectUtils.getMergedProps(e,S.defaultProps)},getOtherProps:function(e){return o.ObjectUtils.getDiffProps(e,S.defaultProps)}};function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function N(e,t){if("object"!==O(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,t||"default");if("object"!==O(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function w(e){var t=N(e,"string");return"symbol"===O(t)?t:String(t)}var j={defaultProps:{__TYPE:"Badge",value:null,severity:null,size:null,style:null,className:null,children:void 0},getProps:function(e){return o.ObjectUtils.getMergedProps(e,j.defaultProps)},getOtherProps:function(e){return o.ObjectUtils.getDiffProps(e,j.defaultProps)}},P=u.memo(u.forwardRef((function(e,t){var n,l,r,a=j.getProps(e),i=u.useRef(null),c=j.getOtherProps(a),p=o.classNames("p-badge p-component",(n={"p-badge-no-gutter":o.ObjectUtils.isNotEmpty(a.value)&&1===String(a.value).length,"p-badge-dot":o.ObjectUtils.isEmpty(a.value),"p-badge-lg":"large"===a.size,"p-badge-xl":"xlarge"===a.size},l="p-badge-".concat(a.severity),r=null!==a.severity,(l=w(l))in n?Object.defineProperty(n,l,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[l]=r,n),a.className);return u.useImperativeHandle(t,(function(){return{props:a,getElement:function(){return i.current}}})),u.createElement("span",s({ref:i,className:p,style:a.style},c),a.value)})));function B(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=U(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var l=0,r=function(){};return{s:r,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function U(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}P.displayName="Badge";var C=u.memo(u.forwardRef((function(e,i){var c=S.getProps(e),p=E(u.useState([]),2),m=p[0],f=p[1],d=E(u.useState([]),2),v=d[0],g=d[1],h=E(u.useState(0),2),O=h[0],N=h[1],w=E(u.useState(!1),2),j=w[0],U=w[1],T=E(u.useState(!1),2),C=T[0],F=T[1],M=u.useRef(null),z=u.useRef(null),D=u.useRef(null),x=u.useRef(!1),I=u.useRef(0),R=o.ObjectUtils.isNotEmpty(v),L=o.ObjectUtils.isNotEmpty(m),A=c.disabled||C,k=c.chooseLabel||c.chooseOptions.label||t.localeOption("choose"),_=c.uploadLabel||c.uploadOptions.label||t.localeOption("upload"),H=c.cancelLabel||c.cancelOptions.label||t.localeOption("cancel"),q=A||c.fileLimit&&c.fileLimit<=v.length+I,X=A||!R,J=A||!R,V=function(e){return/^image\//.test(e.type)},K=function(e,t){W();var n=y(v),l=v[t];n.splice(t,1),g(n),c.onRemove&&c.onRemove({originalEvent:e,file:l})},Y=function(e,t){W();var n=y(m),l=v[t];n.splice(t,1),f(n),c.onRemove&&c.onRemove({originalEvent:e,file:l})},W=function(){M.current&&(M.current.value="")},$=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},G=function(e){if(!c.onBeforeSelect||!1!==c.onBeforeSelect({originalEvent:e,files:v}))if("drop"!==e.type&&Q()&&x.current)x.current=!1;else{var t=[];c.multiple&&(t=v?y(v):[]);for(var n=e.dataTransfer?e.dataTransfer.files:e.target.files,l=0;l<n.length;l++){var r=n[l];!Z(r)&&ee(r)&&(V(r)&&(r.objectURL=window.URL.createObjectURL(r)),t.push(r))}g(t),o.ObjectUtils.isNotEmpty(t)&&c.auto&&te(t),c.onSelect&&c.onSelect({originalEvent:e,files:n}),"drop"!==e.type&&Q()?M.current&&(x.current=!0,M.current.value=""):W(),"basic"===c.mode&&t.length>0&&(M.current.style.display="none")}},Z=function(e){return v.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},Q=function(){return!!window.MSInputMethodContext&&!!document.documentMode},ee=function(e){if(c.maxFileSize&&e.size>c.maxFileSize){var t={severity:"error",summary:c.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:c.invalidFileSizeMessageDetail.replace("{0}",$(c.maxFileSize)),sticky:!0};return"advanced"===c.mode&&z.current.show(t),c.onValidationFail&&c.onValidationFail(e),!1}return!0},te=function(e){if((e=e||v)&&e.nativeEvent&&(e=v),c.customUpload)c.fileLimit&&b("uploadedFileCount"),c.uploadHandler&&c.uploadHandler({files:e,options:{clear:ne,props:c}});else{F(!0);var t=new XMLHttpRequest,n=new FormData;c.onBeforeUpload&&c.onBeforeUpload({xhr:t,formData:n});var l,r=B(e);try{for(r.s();!(l=r.n()).done;){var a=l.value;n.append(c.name,a,a.name)}}catch(e){r.e(e)}finally{r.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);N(t),c.onProgress&&c.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(N(0),F(!1),t.status>=200&&t.status<300?(c.fileLimit&&b("uploadedFileCount"),c.onUpload&&c.onUpload({xhr:t,files:e})):c.onError&&c.onError({xhr:t,files:e}),f((function(t){return[].concat(y(t),y(e))})),ne())},t.open("POST",c.url,!0),c.onBeforeSend&&c.onBeforeSend({xhr:t,formData:n}),t.withCredentials=c.withCredentials,t.send(n)}},ne=function(){g([]),F(!1),c.onClear&&c.onClear(),W()},le=function(){M.current.click()},re=function(){U(!0)},ae=function(){U(!1)},oe=function(e){13===e.which&&le()},ie=function(e){A||(e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault())},ue=function(e){A||(e.dataTransfer.dropEffect="copy",o.DomHandler.addClass(D.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault())},se=function(e){A||(e.dataTransfer.dropEffect="copy",o.DomHandler.removeClass(D.current,"p-fileupload-highlight"))},ce=function(e){if(!c.disabled&&(o.DomHandler.removeClass(D.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault(),!c.onBeforeDrop||!1!==c.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(c.multiple||o.ObjectUtils.isEmpty(v)&&t&&1===t.length)&&G(e)}},pe=function(){!A&&R?te():M.current.click()};u.useImperativeHandle(i,(function(){return{props:c,upload:te,clear:ne,formatSize:$,onFileSelect:G,getInput:function(){return M.current},getContent:function(){return D.current},getFiles:function(){return v},setFiles:function(e){return g(e||[])}}}));var me,fe,de,ye,be,ve,ge,he,Ee,Se,Oe=function(e,t,n){"warning"===t.severity?K(e,n):Y(e,n)},Ne=function(e,t,l){var r=e.name+e.type+e.size,a=V(e)?u.createElement("img",{role:"presentation",className:"p-fileupload-file-thumbnail",alt:e.name,src:e.objectURL,width:c.previewWidth}):null,i=u.createElement("div",{className:"p-fileupload-filename"},e.name),s=u.createElement("div",null,$(e.size)),p=u.createElement("div",null,u.createElement("div",null," ",e.name),u.createElement("span",null,$(e.size)),u.createElement(P,{className:"p-fileupload-file-badge",value:l.value,severity:l.severity})),m=u.createElement("div",null,u.createElement(n.Button,{type:"button",icon:"pi pi-times",className:"p-button-danger p-button-text p-button-rounded",onClick:function(e){return Oe(e,l,t)},disabled:A})),f=u.createElement(u.Fragment,null,a,p,m);if(c.itemTemplate){var d={onRemove:function(e){return K(e,t)},previewElement:a,fileNameElement:i,sizeElement:s,removeElement:m,formatSize:$(e.size),element:f,index:t,props:c};f=o.ObjectUtils.getJSXElement(c.itemTemplate,e,d)}return u.createElement("div",{className:"p-fileupload-row",key:r},f)},we=function(){var e={severity:"success",value:"Completed"},t=m&&m.map((function(t,n){return Ne(t,n,e)}));return u.createElement("div",null,t)};return"advanced"===c.mode?function(){var e,t,i,p,m,f,d,y,b,g,h,E,N,w,P,B,U=S.getOtherProps(c),T=o.classNames("p-fileupload p-fileupload-advanced p-component",c.className),C=o.classNames("p-fileupload-buttonbar",c.headerClassName),F=o.classNames("p-fileupload-content",c.contentClassName),x=(t=(e=c.chooseOptions).style,i=e.icon,m=o.classNames("p-button p-fileupload-choose p-component",{"p-disabled":A,"p-focus":j,"p-button-icon-only":p=e.iconOnly},e.className),f="p-button-label p-clickable",d=p?u.createElement("span",{className:f,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):u.createElement("span",{className:f},k),y=u.createElement("input",{ref:M,type:"file",onChange:G,multiple:c.multiple,accept:c.accept,disabled:q}),b=o.IconUtils.getJSXIcon(i||"pi pi-fw pi-plus",{className:"p-button-icon p-button-icon-left p-clickable"},{props:c}),u.createElement("span",{className:m,style:t,onClick:le,onKeyDown:oe,onFocus:re,onBlur:ae,tabIndex:0},y,b,d,u.createElement(a.Ripple,null))),I=!c.emptyTemplate||R||L?null:o.ObjectUtils.getJSXElement(c.emptyTemplate,c);if(!c.auto){var V=c.uploadOptions,K=c.cancelOptions,Y=K.iconOnly?"":H;g=u.createElement(n.Button,{type:"button",label:V.iconOnly?"":_,icon:V.icon||"pi pi-upload",onClick:te,disabled:X,style:V.style,className:V.className}),h=u.createElement(n.Button,{type:"button",label:Y,icon:K.icon||"pi pi-times",onClick:ne,disabled:J,style:K.style,className:K.className})}R&&(P={severity:"warning",value:"Pending"},B=v.map((function(e,t){return Ne(e,t,P)})),E=u.createElement("div",null,B),w=c.progressBarTemplate?o.ObjectUtils.getJSXElement(c.progressBarTemplate,c):u.createElement(r.ProgressBar,{value:O,showValue:!1})),L&&(N=we());var W=u.createElement("div",{className:C,style:c.headerStyle},x,g,h);c.headerTemplate&&(W=o.ObjectUtils.getJSXElement(c.headerTemplate,{className:C,chooseButton:x,uploadButton:g,cancelButton:h,element:W,props:c}));return u.createElement("div",s({id:c.id,className:T,style:c.style},U),W,u.createElement("div",{ref:D,className:F,style:c.contentStyle,onDragEnter:ie,onDragOver:ue,onDragLeave:se,onDrop:ce},w,u.createElement(l.Messages,{ref:z}),R?E:null,L?N:null,I))}():"basic"===c.mode?(me=c.chooseOptions,fe=S.getOtherProps(c),de=o.classNames("p-fileupload p-fileupload-basic p-component",c.className),ye=o.classNames("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":R,"p-disabled":A,"p-focus":j},me.className),be=me.icon||o.classNames({"pi pi-plus":!me.icon&&(!R||c.auto),"pi pi-upload":!me.icon&&R&&!c.auto}),ve="p-button-label p-clickable",ge=me.iconOnly?u.createElement("span",{className:ve,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):u.createElement("span",{className:ve},k),he=c.auto?ge:u.createElement("span",{className:ve},R?v[0].name:ge),Ee=o.IconUtils.getJSXIcon(be,{className:"p-button-icon p-button-icon-left"},{props:c,hasFiles:R}),Se=!R&&u.createElement("input",{ref:M,type:"file",accept:c.accept,multiple:c.multiple,disabled:A,onChange:G}),u.createElement("div",s({className:de,style:c.style},fe),u.createElement(l.Messages,{ref:z}),u.createElement("span",{className:ye,style:me.style,onMouseUp:pe,onKeyDown:oe,onFocus:re,onBlur:ae,tabIndex:0},Ee,he,Se,u.createElement(a.Ripple,null)))):void 0})));C.displayName="FileUpload",exports.FileUpload=C;
